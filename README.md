# Bilibili 广告跳过工具（切片广告之友）

这是一个Chrome扩展，用于自动跳过哔哩哔哩(Bilibili)视频中的广告内容。它提供了直观的用户界面和丰富的功能，使视频观看体验更加流畅。

> **注意：** 由于版本管理和模板的原因，核心业务代码位于 `./chrome_plugin/bilibili-sidebar_self` 目录内，外层目录不包含相关业务逻辑。

## 功能特点

- 🎯 自动检测和跳过视频中的广告
- 📊 广告区域在进度条上可视化标记
- ⚙️ 支持为每个视频单独设置广告时间段
- 💾 自动保存广告时间段，再次观看时无需重复设置
- 🔗 支持通过URL参数共享广告时间段
- 👤 UP主白名单功能，支持特定UP主视频切换为手动跳过模式
- 🔄 全局开关控制，随时可以启用/禁用功能
- 📏 支持调整广告跳过的触发范围（从1%到100%）
- 🛠️ 管理员模式，用于高级设置和数据管理

## 本地安装步骤

> **注意：** 本地安装可能因为插件ID差异而无法访问服务端，仅可以查看客户端的业务功能。

1. 下载本项目并解压
2. 打开Chrome浏览器，进入扩展管理页面（`chrome://extensions/`）
3. 开启"开发者模式"
4. 点击"加载已解压的扩展程序"
5. 选择项目文件夹内的 `chrome_plugin/bilibili-sidebar_self` 目录

## 使用说明

### 基本使用

1. **功能入口：** 在B站视频页面右上角会显示一个悬浮按钮，包含当前视频的设置和基础功能
2. **灵活设置：** 如果AI错误识别了广告区间，您可以手动拖拽进度条跳回，或在悬浮按钮菜单里临时切换手动跳过模式，或者手动编辑修改广告区间并重新应用设置
3. **识别次数：** 处理视频时可能不会消耗AI识别次数，这是因为该视频已在数据库中有识别记录
4. **处理条件：** 仅对总时长30秒以上的视频进行AI识别处理，短视频会被自动跳过
5. **本地缓存：** 重复观看同一个视频不会消耗识别次数，识别结果会保存在本地浏览器中

### 广告位可视化标记

- 视频进度条上以红色区域标记完整广告区间
- 粉红色区域表示触发广告跳过的实际区间（基于设置的百分比）
- 鼠标悬停在广告标记上可显示详细信息
- 点击广告标记可以手动跳过广告

### 全局开关与跳过百分比

- 点击"⏩ 广告跳过"按钮打开控制面板
- 面板顶部有一个开关，可以临时启用/禁用广告跳过功能
- 使用百分比滑块控制广告跳过的触发范围：
  - 1%: 仅在广告开始时触发跳过
  - 50%: 在广告前半段触发跳过
  - 100%: 整个广告区间都会触发跳过

### UP主白名单功能

1. 在视频页面点击"⏩ 广告跳过"按钮
2. 在控制面板中会显示当前UP主信息
3. 使用"白名单"开关将当前UP主添加/移除白名单
4. 白名单中UP主的视频不会自动跳过广告，但仍可通过点击广告标记手动跳过
5. 在扩展选项页面的"UP主白名单"选项卡可以批量管理白名单

### 通过URL分享

1. 在设置界面输入广告时间段后，点击"创建分享链接"按钮
2. 复制生成的链接分享给他人
3. 他人点击链接后，插件会自动应用广告跳过设置

## 开发计划

### 前端优化

- [ ] **代码清理**：清理测试期遗留和注销的废弃代码
- [ ] **白名单管理**：设置数据量上限和自动清除机制（如100天以上或500条记录）
- [ ] **初始化优化**：优化BV ID提取逻辑，避免重复调用（当前初始化调用4次）
- [ ] **视频时长检测**：提前视频时长检测时机，在首次获取信息后即可省略字幕检查
- [ ] **问题反馈**：一键反馈问题识别功能，快速添加数据标记
- [ ] **快捷键支持**：为手动模式的广告跳过增加键盘快捷键
- [ ] **合作模式**：解决合作模式下UP主信息获取问题

### 后端优化

- [ ] **数据库重构**：将数据库逻辑改为ORM方法
- [ ] **AI检测优化**：对检测时长比例过长的情况进行例外处理（用户可能在观看喜欢的广告）
- [ ] **领域知识集成**：对特定子板块添加额外知识支持（如逗鱼时刻内的炉石传说相关广告豁免）